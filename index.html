<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" onload="console.log('Chart.js loaded successfully')" onerror="console.error('Failed to load Chart.js')"></script>
</head>
<body>

    <nav class="navbar" id="mainNavbar">
        <div class="nav-container">
            <div class="nav-left">
                <h1 class="nav-title">Budgeting App</h1>
                <button type="button" id="obfuscateBtn" class="obfuscate-btn" title="Hide sensitive information">üëÅÔ∏è</button>
            </div>
            <ul class="nav-menu">
                <li><a href="#" class="nav-link active" onclick="navigateTo('home')">Home</a></li>
                <li><a href="#" class="nav-link" onclick="navigateTo('recurring')">Recurring</a></li>
                <li><a href="#" class="nav-link" onclick="navigateTo('charts')">Charts</a></li>
                <li><a href="#" class="nav-link" onclick="navigateTo('settings')">Settings</a></li>
            </ul>
        </div>
    </nav>

    <!-- Onboarding Flow -->
    <div id="onboardingPage" class="page active">
        <div class="onboarding-container">
            <!-- Step 1: Welcome & Spreadsheet ID -->
            <div id="onboardingStep1" class="onboarding-step active">
                <div class="onboarding-content">
                    <h1>Welcome to Budgeting App! üéØ</h1>
                    <p>Let's set up your personalized budgeting experience in just a few steps.</p>
                    
                    <div class="onboarding-form">
                        <h3>First, let's connect to your Google Spreadsheet</h3>
                        <p>Go to <a href="https://sheets.google.com" target="_blank">Google Sheets</a>, create a new spreadsheet, and copy its ID from the URL.</p>
                        
                        <div class="example-box">
                            <strong>Example URL:</strong><br>
                            <code>https://docs.google.com/spreadsheets/d/<span class="highlight">1oqS9MSo3XVw95jNPX-Lz0um-ookdlbM4uWzDtWyL3bU</span>/edit</code><br>
                            <small>The highlighted part is your Spreadsheet ID</small>
                        </div>
                        
                        <label>Your Spreadsheet ID *</label>
                        <input type="text" id="onboardingSpreadsheetId" placeholder="Paste your Spreadsheet ID here" required>
                        <small>This will be used to connect your app to your spreadsheet</small>
                        
                        <button type="button" class="btn-primary" id="step1ContinueBtn" onclick="nextOnboardingStep()" disabled>Continue to Apps Script Setup ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Apps Script Setup -->
            <div id="onboardingStep2" class="onboarding-step">
                <div class="onboarding-content">
                    <h2>Setup Apps Script üìä</h2>
                    <p>Now we'll set up the Google Apps Script to connect your spreadsheet to the app.</p>
                    
                    <div class="setup-tabs">
                        <button type="button" class="tab-btn active" onclick="showSetupTab('script')">
                            1. Copy & Deploy Script
                        </button>
                        <button type="button" class="tab-btn" onclick="showSetupTab('connect')">
                            2. Test Connection
                        </button>
                    </div>

                    <!-- Tab 1: Apps Script Setup -->
                    <div id="scriptTab" class="setup-tab active">
                        <div class="instruction-card">
                            <h3>‚öôÔ∏è Step 1: Copy & Deploy Apps Script</h3>
                            <ol class="instruction-list">
                                <li>Go to <a href="https://script.google.com" target="_blank">Google Apps Script</a></li>
                                <li>Click "New project"</li>
                                <li>Replace the default code with the code below (it's already customized with your Spreadsheet ID!)</li>
                            </ol>
                            
                            <div class="code-container">
                                <div class="code-header">
                                    <span>Apps Script Code (Personalized for Your Spreadsheet)</span>
                                    <button type="button" class="copy-btn" onclick="copyAppsScript()">üìã Copy Code</button>
                                </div>
                                <textarea id="appsScriptCode" readonly class="code-textarea"></textarea>
                            </div>

                            <ol class="instruction-list" start="4">
                                <li>Paste the code into your Apps Script editor</li>
                                <li>Click "Save" (üíæ)</li>
                                <li>Click "Deploy" ‚Üí "New deployment"</li>
                                <li>Choose "Web app" as the type</li>
                                <li>Set "Execute as" to "Me"</li>
                                <li>Set "Who has access" to "Anyone"</li>
                                <li>Click "Deploy" and copy the Web App URL</li>
                            </ol>

                            <label>Apps Script Web App URL:</label>
                            <input type="text" id="onboardingScriptURL" placeholder="Paste your Web App URL here" required>
                            <small>Should look like: https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec</small>
                            
                            <button type="button" class="btn-primary tab-next" onclick="showSetupTab('connect')" disabled>Next: Test Connection ‚Üí</button>
                        </div>
                    </div>

                    <!-- Tab 2: Connect -->
                    <div id="connectTab" class="setup-tab">
                        <div class="instruction-card">
                            <h3>üîó Step 2: Test Connection</h3>
                            <p>Let's make sure everything is working correctly.</p>
                            
                            <div class="connection-status">
                                <div id="connectionTest" class="connection-result">
                                    <span>Click "Test Connection" to verify your setup</span>
                                </div>
                                <button type="button" class="btn-primary" onclick="testConnection()">üîç Test Connection</button>
                            </div>
                            
                            <div class="tab-buttons">
                                <button type="button" class="btn-secondary" onclick="showSetupTab('script')">‚Üê Back</button>
                                <button type="button" class="btn-primary" id="step2ContinueBtn" onclick="nextOnboardingStep()" disabled>Continue to Accounts ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Account Setup -->
            <div id="onboardingStep3" class="onboarding-step">
                <div class="onboarding-content">
                    <h2>Set Up Your Accounts üè¶</h2>
                    <p>Add the accounts you'll be tracking (checking, savings, credit cards, etc.)</p>
                    
                    <div class="accounts-section">
                        <div class="input-with-button">
                            <input type="text" id="newAccountName" placeholder="Account name (e.g., Checking)">
                            <button type="button" onclick="addAccount()">Add</button>
                        </div>
                        
                        <div id="accountsList" class="items-list">
                            <!-- Accounts will be added here dynamically -->
                        </div>
                    </div>
                    
                    <div class="onboarding-buttons">
                        <button type="button" class="btn-secondary" onclick="prevOnboardingStep()">Back</button>
                        <button type="button" class="btn-primary" id="step3ContinueBtn" onclick="nextOnboardingStep()" disabled>Continue</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Category Setup -->
            <div id="onboardingStep4" class="onboarding-step">
                <div class="onboarding-content">
                    <h2>Customize Categories üìù</h2>
                    <p>Modify or add expense categories that fit your spending habits.</p>
                    
                    <div class="categories-section">
                        <div class="input-with-button">
                            <input type="text" id="newCategoryName" placeholder="Category name (e.g., Entertainment)">
                            <button type="button" onclick="addCategory()">Add</button>
                        </div>
                        
                        <div id="categoriesList" class="items-list">
                            <!-- Categories will be loaded here dynamically -->
                        </div>
                    </div>
                    
                    <div class="onboarding-buttons">
                        <button type="button" class="btn-secondary" onclick="prevOnboardingStep()">Back</button>
                        <button type="button" class="btn-primary" id="step4ContinueBtn" onclick="nextOnboardingStep()">Continue</button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Personal Info & Completion -->
            <div id="onboardingStep5" class="onboarding-step">
                <div class="onboarding-content">
                    <h2>Almost Done! ‚ú®</h2>
                    <p>Just a few final details to personalize your experience.</p>
                    
                    <form id="personalInfoForm" class="onboarding-form">
                        <label>Your Name (optional)</label>
                        <input type="text" id="onboardingUserName" placeholder="How should we address you?">
                        
                        <label>Currency</label>
                        <select id="onboardingCurrency">
                            <option value="RON" selected>RON (lei)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="GBP">GBP (¬£)</option>
                            <option value="CAD">CAD ($)</option>
                            <option value="AUD">AUD ($)</option>
                        </select>
                        
                        <div class="onboarding-buttons">
                            <button type="button" class="btn-secondary" onclick="prevOnboardingStep()">Back</button>
                            <button type="button" class="btn-primary" onclick="completeOnboarding()">Complete Setup</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Progress indicator -->
            <div class="onboarding-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="currentStep">1</span> of <span id="totalSteps">5</span>
                </div>
            </div>
        </div>
    </div>

    <div id="homePage" class="page">
        <div class="header-container">
            <h2 class="header-title">New Transaction</h2>
        </div>
    <form id="trackerForm">
        <label>Amount *</label>
        <input type="number" id="amount" step="0.01" required>

        <label>Payee *</label>
        <input type="text" id="payee" list="payeeList" autocomplete="off">
        <datalist id="payeeList"></datalist>
        <div id="payeeSuggestions"></div>

        <label>Category</label>
        <select id="category">
            <option>Childcare & School</option><option>Debt</option><option>Education</option>
            <option>Entertainment</option><option>Going out</option><option selected>Groceries</option>
            <option>Healthcare</option><option>Housing</option><option>Insurance</option>
            <option>Others</option><option>Personal Care</option><option>Savings & Investments</option>
            <option>Transportation</option><option>Utilities</option><option>Vacation</option>
            <option data-income-only="true" disabled style="display: none;">Account</option>
        </select>

        <label>Notes</label>
        <textarea id="notes" rows="3"></textarea>

        <label>Date</label>
        <input type="date" id="date" required>

        <label>Day of the Week</label>
        <input type="text" id="dayOfWeek" readonly>

        <label>Account Used</label>
        <select id="account">
            <option>Ale</option>
            <option>Tavi</option>
        </select>

        <label>Type</label>
        <select id="type">
            <option value="Expense" selected>Expense</option>
            <option value="Income">Income</option>
        </select>

        <div class="recurring-section">
            <div class="recurring-checkbox-container">
                <input type="checkbox" id="isRecurring" name="isRecurring">
                <label for="isRecurring" class="recurring-label">üîÑ Make this a recurring transaction</label>
            </div>
            
            <div id="recurringOptions" class="recurring-options" style="display: none;">
                <div class="recurring-grid">
                    <div class="recurring-field">
                        <label>Frequency *</label>
                        <select id="frequency">
                            <option value="">Select frequency</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="biweekly">Bi-weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>

                    <div class="recurring-field">
                        <label>Start Date</label>
                        <input type="date" id="recurringStartDate">
                    </div>

                    <div class="recurring-field">
                        <label>End Date (Optional)</label>
                        <input type="date" id="recurringEndDate">
                    </div>

                    <div class="recurring-field">
                        <label>Next Due Date</label>
                        <input type="date" id="nextDueDate" readonly>
                    </div>
                </div>
                
                <div class="recurring-description">
                    <small id="recurringDescription" class="recurring-desc-text"></small>
                </div>
            </div>
        </div>

        <button type="submit" id="submitBtn">Add Transaction</button>
    </form>

    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="none" stroke="#28a745" stroke-width="4"/>
                <path d="M 30 50 L 45 65 L 70 35" fill="none" stroke="#28a745" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p class="success-message" id="successMessage">Success! Transaction added!</p>
        </div>
    </div>

    <div class="transactions-container">
        <div class="transactions-header">
            <h2>Recent Transactions</h2>
            <button type="button" id="refreshBtn" class="refresh-btn" title="Refresh transactions">üîÑ</button>
        </div>
        <table class="transactions-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Payee</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Account</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="transactionsBody">
                <tr><td colspan="7" style="text-align: center; color: #999;">Loading transactions...</td></tr>
            </tbody>
        </table>
    </div>

    <button type="button" id="viewSpreadsheetBtn" onclick="openSpreadsheet()" class="view-spreadsheet-btn view-spreadsheet-bottom">üìä View Spreadsheet</button>
    </div>

    <div id="recurringPage" class="page">
        <div class="header-container">
            <h2 class="header-title">Recurring Transactions</h2>
            <button type="button" id="processRecurringBtn" class="process-recurring-btn" onclick="processRecurringTransactions()">üîÑ Process Due</button>
        </div>

        <div class="recurring-stats">
            <div class="stat-card">
                <h3>Active</h3>
                <div class="stat-number" id="activeRecurringCount">0</div>
            </div>
            <div class="stat-card">
                <h3>Due Today</h3>
                <div class="stat-number" id="dueRecurringCount">0</div>
            </div>
        </div>

        <div class="transactions-container">
            <div class="transactions-header">
                <h3>All Recurring Transactions</h3>
                <div style="display: flex; gap: 10px;">
                    <button type="button" id="addRecurringBtn" class="add-recurring-btn" onclick="openAddRecurringModal()">+ Add Recurring</button>
                </div>
            </div>
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Payee</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Type</th>
                        <th>Frequency</th>
                        <th>Next Due</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recurringTransactionsBody">
                    <tr><td colspan="8" style="text-align: center; color: #999;">Loading recurring transactions...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="chartsPage" class="page">
        <div class="header-container">
            <h2 class="header-title">Financial Charts</h2>
        </div>

        <div class="chart-filters">
            <div class="filter-dates">
                <div class="date-input-group">
                    <label>From</label>
                    <input type="date" id="chartStartDate">
                </div>
                <div class="date-input-group">
                    <label>To</label>
                    <input type="date" id="chartEndDate">
                </div>
            </div>

            <div class="quick-filters">
                <button type="button" id="todayBtn" class="quick-filter-btn">Today</button>
                <button type="button" id="lastMonthBtn" class="quick-filter-btn">Last Month</button>
                <button type="button" id="thisMonthBtn" class="quick-filter-btn">This Month</button>
                <button type="button" id="thisYearBtn" class="quick-filter-btn">This Year</button>
            </div>

            <button type="button" id="applyFilterBtn" class="filter-btn">Apply Filter</button>
            <button type="button" id="refreshChartsBtn" class="filter-btn" onclick="retryLoadCharts()">üîÑ Refresh Data</button>
        </div>

        <div class="charts-container">
            <div class="chart-wrapper">
                <h3>Expenses by Category</h3>
                <canvas id="expensesCategoryChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <h3>Expenses vs Income</h3>
                <canvas id="expensesVsIncomeChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <h3>Expenses by Category (Ranked)</h3>
                <canvas id="expensesCategoryBarChart"></canvas>
            </div>
        </div>
    </div>

    <div id="settingsPage" class="page">
        <div class="header-container">
            <h2 class="header-title">Settings</h2>
        </div>
        
        <div class="settings-container">
            <div class="settings-section">
                <h3>Current Configuration</h3>
                <div class="config-display" id="configDisplay">
                    <!-- Configuration will be displayed here -->
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Actions</h3>
                <div class="settings-actions">
                    <button type="button" class="btn-success" onclick="viewSpreadsheet()">
                        üìä View Spreadsheet
                    </button>
                    <button type="button" class="btn-warning" onclick="showReconfigureModal()">
                        üîÑ Reconfigure Settings
                    </button>
                    <button type="button" class="btn-danger" onclick="showResetModal()">
                        üóëÔ∏è Reset All Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modals -->
    <div id="reconfigureModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <span class="delete-icon">üîÑ</span>
                <h3>Reconfigure Settings</h3>
            </div>
            <p class="delete-message">This will restart the setup process with your current settings prefilled. You can modify any settings you want to change.</p>
            <div class="delete-modal-buttons">
                <button type="button" class="btn-cancel" onclick="closeReconfigureModal()">Cancel</button>
                <button type="button" class="btn-warning" onclick="confirmReconfigure()">Reconfigure</button>
            </div>
        </div>
    </div>

    <div id="resetModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <span class="delete-icon">‚ö†Ô∏è</span>
                <h3>Reset All Data</h3>
            </div>
            <p class="delete-message"><strong>Warning:</strong> This will permanently delete ALL your configuration, accounts, categories, and settings. This action cannot be undone.</p>
            <p style="color: #dc3545; font-weight: bold; margin-top: 10px;">Are you absolutely sure you want to continue?</p>
            <div class="delete-modal-buttons">
                <button type="button" class="btn-cancel" onclick="closeResetModal()">Cancel</button>
                <button type="button" class="btn-delete" onclick="confirmReset()">Reset Everything</button>
            </div>
        </div>
    </div>

    <!-- Modals (outside page containers for global access) -->
    <div id="deleteModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <span class="delete-icon">‚ö†Ô∏è</span>
                <h3>Delete Transaction</h3>
            </div>
            <p class="delete-message">Are you sure you want to delete this transaction? This action cannot be undone.</p>
            <div class="delete-transaction-details" id="deleteTransactionDetails"></div>
            <div class="delete-modal-buttons">
                <button type="button" class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button type="button" class="btn-delete" id="confirmDeleteBtn" onclick="handleDelete()">Delete</button>
            </div>
        </div>
    </div>

    <div id="editModal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>‚úèÔ∏è Edit Transaction</h3>
                <button type="button" class="edit-modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editTransactionForm">
                <input type="hidden" id="editRowIndex">
                
                <label>Amount *</label>
                <input type="number" id="editAmount" step="0.01" required>

                <label>Payee *</label>
                <input type="text" id="editPayee" required>

                <label>Category</label>
                <select id="editCategory">
                    <option>Childcare & School</option><option>Debt</option><option>Education</option>
                    <option>Entertainment</option><option>Going out</option><option>Groceries</option>
                    <option>Healthcare</option><option>Housing</option><option>Insurance</option>
                    <option>Others</option><option>Personal Care</option><option>Savings & Investments</option>
                    <option>Transportation</option><option>Utilities</option><option>Vacation</option>
                    <option>Account</option>
                </select>

                <label>Notes</label>
                <textarea id="editNotes" rows="3"></textarea>

                <label>Date</label>
                <input type="date" id="editDate" required>

                <label>Day of the Week</label>
                <input type="text" id="editDayOfWeek" readonly>

                <label>Account Used</label>
                <select id="editAccount">
                    <option>Ale</option>
                    <option>Tavi</option>
                </select>

                <label>Type</label>
                <select id="editType">
                    <option value="Expense">Expense</option>
                    <option value="Income">Income</option>
                </select>

                <div class="edit-modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn-save" id="saveEditBtn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recurring Transaction Modals -->
    <div id="addRecurringModal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>‚ûï Add Recurring Transaction</h3>
                <button type="button" class="edit-modal-close" onclick="closeAddRecurringModal()">&times;</button>
            </div>
            <form id="addRecurringForm">
                <label>Amount *</label>
                <input type="number" id="recurringModalAmount" step="0.01" required>

                <label>Payee *</label>
                <input type="text" id="recurringModalPayee" required>

                <label>Category</label>
                <select id="recurringModalCategory">
                    <option>Childcare & School</option><option>Debt</option><option>Education</option>
                    <option>Entertainment</option><option>Going out</option><option>Groceries</option>
                    <option>Healthcare</option><option>Housing</option><option>Insurance</option>
                    <option>Others</option><option>Personal Care</option><option>Savings & Investments</option>
                    <option>Transportation</option><option>Utilities</option><option>Vacation</option>
                    <option>Account</option>
                </select>

                <label>Notes</label>
                <textarea id="recurringModalNotes" rows="2"></textarea>

                <label>Account Used</label>
                <select id="recurringModalAccount">
                    <option>Ale</option>
                    <option>Tavi</option>
                </select>

                <label>Type</label>
                <select id="recurringModalType">
                    <option value="Expense">Expense</option>
                    <option value="Income">Income</option>
                </select>

                <div class="recurring-options-modal">
                    <label>Frequency *</label>
                    <select id="recurringModalFrequency" required>
                        <option value="">Select frequency</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>

                    <label>Start Date *</label>
                    <input type="date" id="recurringModalStartDate" required>

                    <label>End Date (Optional)</label>
                    <input type="date" id="recurringModalEndDate">
                </div>

                <div class="edit-modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeAddRecurringModal()">Cancel</button>
                    <button type="submit" class="btn-save">Create Recurring Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editRecurringModal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>‚úèÔ∏è Edit Recurring Transaction</h3>
                <button type="button" class="edit-modal-close" onclick="closeEditRecurringModal()">&times;</button>
            </div>
            <form id="editRecurringForm">
                <input type="hidden" id="editRecurringId">
                
                <label>Amount *</label>
                <input type="number" id="editRecurringAmount" step="0.01" required>

                <label>Payee *</label>
                <input type="text" id="editRecurringPayee" required>

                <label>Category</label>
                <select id="editRecurringCategory">
                    <option>Childcare & School</option><option>Debt</option><option>Education</option>
                    <option>Entertainment</option><option>Going out</option><option>Groceries</option>
                    <option>Healthcare</option><option>Housing</option><option>Insurance</option>
                    <option>Others</option><option>Personal Care</option><option>Savings & Investments</option>
                    <option>Transportation</option><option>Utilities</option><option>Vacation</option>
                    <option>Account</option>
                </select>

                <label>Notes</label>
                <textarea id="editRecurringNotes" rows="2"></textarea>

                <label>Account Used</label>
                <select id="editRecurringAccount">
                    <option>Ale</option>
                    <option>Tavi</option>
                </select>

                <label>Type</label>
                <select id="editRecurringType">
                    <option value="Expense">Expense</option>
                    <option value="Income">Income</option>
                </select>

                <div class="recurring-options-modal">
                    <label>Frequency *</label>
                    <select id="editRecurringFrequency" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>

                    <label>Start Date *</label>
                    <input type="date" id="editRecurringStartDate" required>

                    <label>End Date (Optional)</label>
                    <input type="date" id="editRecurringEndDate">

                    <label>Next Due Date</label>
                    <input type="date" id="editRecurringNextDue" required>
                </div>

                <div class="edit-modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeEditRecurringModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recurring Transaction Delete Modal -->
    <div id="deleteRecurringModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <span class="delete-icon">‚ö†Ô∏è</span>
                <h3>Delete Recurring Transaction</h3>
            </div>
            <p class="delete-message">Are you sure you want to delete this recurring transaction? This will stop all future automatic transactions but won't affect already created transactions.</p>
            <div class="delete-transaction-details" id="deleteRecurringTransactionDetails"></div>
            <div class="delete-modal-buttons">
                <button type="button" class="btn-cancel" onclick="closeDeleteRecurringModal()">Cancel</button>
                <button type="button" class="btn-delete" id="confirmDeleteRecurringBtn" onclick="handleDeleteRecurring()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="js/storage.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/payee.js"></script>
    <script src="js/form.js"></script>
    <script src="js/transactions.js"></script>
    <script src="js/recurring.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/obfuscation.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/onboarding.js"></script>
    <script src="js/main.js"></script>
</body>
</html>